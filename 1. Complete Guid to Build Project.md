# Complete Taxi Delivery App Development Guide
## Docker + Git + GitHub Actions + Laravel + React

---

## üèóÔ∏è Project Structure with Docker

```
taxi-app/
‚îú‚îÄ‚îÄ .github/
‚îÇ   ‚îî‚îÄ‚îÄ workflows/
‚îÇ       ‚îú‚îÄ‚îÄ backend-ci.yml
‚îÇ       ‚îú‚îÄ‚îÄ frontend-ci.yml
‚îÇ       ‚îî‚îÄ‚îÄ deploy.yml
‚îú‚îÄ‚îÄ backend/ (Laravel API)
‚îÇ   ‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Models/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ User.php
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Driver.php
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Ride.php
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Chat.php
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Payment.php
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Http/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Controllers/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AuthController.php
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ RideController.php
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ChatController.php
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ BillingController.php
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ DriverController.php
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Middleware/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Requests/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Events/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ RideCreated.php
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ DriverLocationUpdated.php
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ MessageSent.php
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Listeners/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Services/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ BillingService.php
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ MapService.php
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ NotificationService.php
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Notifications/
‚îÇ   ‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îú‚îÄ‚îÄ database/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ migrations/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ seeders/
‚îÇ   ‚îú‚îÄ‚îÄ routes/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ api.php
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ channels.php
‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile
‚îÇ   ‚îú‚îÄ‚îÄ composer.json
‚îÇ   ‚îî‚îÄ‚îÄ .env.example
‚îú‚îÄ‚îÄ frontend/ (React)
‚îÇ   ‚îú‚îÄ‚îÄ public/
‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Map/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ GoogleMap.js
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ TaxiMarker.js
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ RouteDisplay.js
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Chat/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ChatWindow.js
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ MessageList.js
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ MessageInput.js
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Profile/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ UserProfile.js
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ DriverProfile.js
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Billing/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ TripCost.js
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ PaymentHistory.js
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Auth/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Login.js
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Register.js
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Layout/
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ Header.js
‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ Sidebar.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pages/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Home.js
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ RideBooking.js
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Trips.js
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Dashboard.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ api.js
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ socket.js
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ auth.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ context/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AuthContext.js
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ SocketContext.js
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ LocationContext.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ utils/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ helpers.js
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ constants.js
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ validation.js
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ App.js
‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile
‚îÇ   ‚îú‚îÄ‚îÄ package.json
‚îÇ   ‚îî‚îÄ‚îÄ .env.example
‚îú‚îÄ‚îÄ nginx/
‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile
‚îÇ   ‚îî‚îÄ‚îÄ nginx.conf
‚îú‚îÄ‚îÄ docker-compose.yml
‚îú‚îÄ‚îÄ docker-compose.prod.yml
‚îú‚îÄ‚îÄ .gitignore
‚îú‚îÄ‚îÄ README.md
‚îî‚îÄ‚îÄ .env.example
```

---

## üìä Database Schema

### Users Table
```sql
CREATE TABLE users (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    email VARCHAR(255) UNIQUE NOT NULL,
    phone VARCHAR(20) UNIQUE NOT NULL,
    password VARCHAR(255) NOT NULL,
    avatar VARCHAR(255) NULL,
    user_type ENUM('customer', 'driver') DEFAULT 'customer',
    is_active BOOLEAN DEFAULT true,
    email_verified_at TIMESTAMP NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);
```

### Drivers Table
```sql
CREATE TABLE drivers (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    user_id BIGINT UNSIGNED NOT NULL,
    license_number VARCHAR(255) UNIQUE NOT NULL,
    vehicle_type VARCHAR(100) NOT NULL,
    vehicle_model VARCHAR(100) NOT NULL,
    vehicle_plate VARCHAR(50) NOT NULL,
    current_latitude DECIMAL(10, 8) NULL,
    current_longitude DECIMAL(11, 8) NULL,
    is_available BOOLEAN DEFAULT false,
    rating DECIMAL(3, 2) DEFAULT 0.00,
    total_rides INT DEFAULT 0,
    status ENUM('pending', 'approved', 'rejected') DEFAULT 'pending',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
);
```

### Rides Table
```sql
CREATE TABLE rides (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    customer_id BIGINT UNSIGNED NOT NULL,
    driver_id BIGINT UNSIGNED NULL,
    pickup_address TEXT NOT NULL,
    pickup_latitude DECIMAL(10, 8) NOT NULL,
    pickup_longitude DECIMAL(11, 8) NOT NULL,
    destination_address TEXT NOT NULL,
    destination_latitude DECIMAL(10, 8) NOT NULL,
    destination_longitude DECIMAL(11, 8) NOT NULL,
    distance_km DECIMAL(8, 2) NULL,
    estimated_duration_minutes INT NULL,
    fare_amount DECIMAL(10, 2) NULL,
    status ENUM('pending', 'accepted', 'picked_up', 'in_progress', 'completed', 'cancelled') DEFAULT 'pending',
    started_at TIMESTAMP NULL,
    completed_at TIMESTAMP NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (customer_id) REFERENCES users(id) ON DELETE CASCADE,
    FOREIGN KEY (driver_id) REFERENCES users(id) ON DELETE SET NULL
);
```

### Chats Table
```sql
CREATE TABLE chats (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    ride_id BIGINT UNSIGNED NOT NULL,
    sender_id BIGINT UNSIGNED NOT NULL,
    receiver_id BIGINT UNSIGNED NOT NULL,
    message TEXT NOT NULL,
    is_read BOOLEAN DEFAULT false,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (ride_id) REFERENCES rides(id) ON DELETE CASCADE,
    FOREIGN KEY (sender_id) REFERENCES users(id) ON DELETE CASCADE,
    FOREIGN KEY (receiver_id) REFERENCES users(id) ON DELETE CASCADE
);
```

### Payments Table
```sql
CREATE TABLE payments (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    ride_id BIGINT UNSIGNED NOT NULL,
    amount DECIMAL(10, 2) NOT NULL,
    payment_method ENUM('cash', 'card', 'mobile_banking') DEFAULT 'cash',
    payment_status ENUM('pending', 'completed', 'failed', 'refunded') DEFAULT 'pending',
    transaction_id VARCHAR(255) NULL,
    paid_at TIMESTAMP NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (ride_id) REFERENCES rides(id) ON DELETE CASCADE
);
```

---

## üê≥ Docker Configuration

### docker-compose.yml
```yaml
version: '3.8'

services:
  # MySQL Database
  mysql:
    image: mysql:8.0
    container_name: taxi_mysql
    restart: unless-stopped
    environment:
      MYSQL_DATABASE: taxi_app
      MYSQL_ROOT_PASSWORD: root_password
      MYSQL_USER: taxi_user
      MYSQL_PASSWORD: taxi_password
    volumes:
      - mysql_data:/var/lib/mysql
      - ./backend/database/init.sql:/docker-entrypoint-initdb.d/init.sql
    ports:
      - "3306:3306"
    networks:
      - taxi_network

  # Redis for caching and real-time features
  redis:
    image: redis:7-alpine
    container_name: taxi_redis
    restart: unless-stopped
    ports:
      - "6379:6379"
    volumes:
      - redis_data:/data
    networks:
      - taxi_network

  # Laravel Backend
  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    container_name: taxi_backend
    restart: unless-stopped
    working_dir: /var/www
    volumes:
      - ./backend:/var/www
      - /var/www/vendor
    ports:
      - "8000:8000"
    depends_on:
      - mysql
      - redis
    environment:
      - APP_ENV=local
      - APP_KEY=base64:YOUR_APP_KEY_HERE
      - DB_CONNECTION=mysql
      - DB_HOST=mysql
      - DB_PORT=3306
      - DB_DATABASE=taxi_app
      - DB_USERNAME=taxi_user
      - DB_PASSWORD=taxi_password
      - REDIS_HOST=redis
      - REDIS_PORT=6379
    networks:
      - taxi_network

  # React Frontend
  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
    container_name: taxi_frontend
    restart: unless-stopped
    volumes:
      - ./frontend:/app
      - /app/node_modules
    ports:
      - "3000:3000"
    depends_on:
      - backend
    environment:
      - REACT_APP_API_URL=http://localhost:8000/api
      - REACT_APP_SOCKET_URL=http://localhost:8000
      - REACT_APP_GOOGLE_MAPS_KEY=YOUR_GOOGLE_MAPS_KEY
    networks:
      - taxi_network

  # Nginx Reverse Proxy
  nginx:
    build:
      context: ./nginx
      dockerfile: Dockerfile
    container_name: taxi_nginx
    restart: unless-stopped
    ports:
      - "80:80"
      - "443:443"
    depends_on:
      - frontend
      - backend
    volumes:
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf
    networks:
      - taxi_network

volumes:
  mysql_data:
  redis_data:

networks:
  taxi_network:
    driver: bridge
```

### Backend Dockerfile
```dockerfile
FROM php:8.2-fpm

# Install system dependencies
RUN apt-get update && apt-get install -y \
    git \
    curl \
    libpng-dev \
    libonig-dev \
    libxml2-dev \
    zip \
    unzip \
    nodejs \
    npm

# Clear cache
RUN apt-get clean && rm -rf /var/lib/apt/lists/*

# Install PHP extensions
RUN docker-php-ext-install pdo_mysql mbstring exif pcntl bcmath gd

# Install Redis PHP extension
RUN pecl install redis && docker-php-ext-enable redis

# Install Composer
COPY --from=composer:latest /usr/bin/composer /usr/bin/composer

# Set working directory
WORKDIR /var/www

# Copy composer files
COPY composer*.json ./

# Install dependencies
RUN composer install --no-scripts --no-autoloader

# Copy application code
COPY . .

# Generate autoloader
RUN composer dump-autoload --optimize

# Set permissions
RUN chown -R www-data:www-data /var/www \
    && chmod -R 755 /var/www/storage \
    && chmod -R 755 /var/www/bootstrap/cache

# Install Laravel Echo Server
RUN npm install -g laravel-echo-server

# Expose port
EXPOSE 8000

# Start services
CMD php artisan migrate --force && php artisan serve --host=0.0.0.0 --port=8000
```

### Frontend Dockerfile
```dockerfile
FROM node:18-alpine

WORKDIR /app

# Copy package files
COPY package*.json ./

# Install dependencies
RUN npm ci --only=production

# Copy source code
COPY . .

# Build the app
RUN npm run build

# Serve the app
EXPOSE 3000

CMD ["npm", "start"]
```

### Nginx Dockerfile & Config
```dockerfile
FROM nginx:alpine

COPY nginx.conf /etc/nginx/nginx.conf

EXPOSE 80 443
```

```nginx
events {
    worker_connections 1024;
}

http {
    upstream backend {
        server backend:8000;
    }

    upstream frontend {
        server frontend:3000;
    }

    server {
        listen 80;
        server_name localhost;

        # Frontend routes
        location / {
            proxy_pass http://frontend;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }

        # Backend API routes
        location /api/ {
            proxy_pass http://backend;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }

        # WebSocket for real-time features
        location /socket.io/ {
            proxy_pass http://backend;
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
    }
}
```

---

## üìù Git Setup & Workflow

### 1. Initialize Repository
```bash
# Initialize git repository
git init

# Create main branch
git checkout -b main

# Add .gitignore
echo "node_modules/
vendor/
.env
.env.local
.env.production
*.log
dist/
build/
docker-data/
.DS_Store
Thumbs.db" > .gitignore

# Initial commit
git add .
git commit -m "Initial project setup with Docker configuration"

# Add remote origin
git remote add origin https://github.com/yourusername/taxi-app.git
git push -u origin main
```

### 2. Branch Strategy
```bash
# Development branch
git checkout -b develop

# Feature branches
git checkout -b feature/user-authentication
git checkout -b feature/ride-booking
git checkout -b feature/real-time-chat
git checkout -b feature/payment-integration

# Release branches
git checkout -b release/v1.0.0

# Hotfix branches
git checkout -b hotfix/critical-bug-fix
```

---

## üöÄ GitHub Actions Workflows

### .github/workflows/backend-ci.yml
```yaml
name: Backend CI

on:
  push:
    branches: [ main, develop ]
    paths: 
      - 'backend/**'
  pull_request:
    branches: [ main ]
    paths: 
      - 'backend/**'

jobs:
  test:
    runs-on: ubuntu-latest
    
    services:
      mysql:
        image: mysql:8.0
        env:
          MYSQL_ROOT_PASSWORD: password
          MYSQL_DATABASE: taxi_test
        ports:
          - 3306:3306
        options: >-
          --health-cmd="mysqladmin ping"
          --health-interval=10s
          --health-timeout=5s
          --health-retries=3
      
      redis:
        image: redis:7-alpine
        ports:
          - 6379:6379
        options: >-
          --health-cmd "redis-cli ping"
          --health-interval 10s
          --health-timeout 5s
          --health-retries 5

    steps:
    - uses: actions/checkout@v3

    - name: Setup PHP
      uses: shivammathur/setup-php@v2
      with:
        php-version: '8.2'
        extensions: mbstring, dom, fileinfo, mysql, redis
        coverage: xdebug

    - name: Install dependencies
      working-directory: ./backend
      run: composer install --prefer-dist --no-interaction

    - name: Copy environment file
      working-directory: ./backend
      run: cp .env.example .env

    - name: Generate application key
      working-directory: ./backend
      run: php artisan key:generate

    - name: Run migrations
      working-directory: ./backend
      run: php artisan migrate
      env:
        DB_CONNECTION: mysql
        DB_HOST: 127.0.0.1
        DB_PORT: 3306
        DB_DATABASE: taxi_test
        DB_USERNAME: root
        DB_PASSWORD: password

    - name: Run tests
      working-directory: ./backend
      run: php artisan test --coverage-clover=coverage.xml

    - name: Upload coverage to Codecov
      uses: codecov/codecov-action@v3
      with:
        files: ./backend/coverage.xml
```

### .github/workflows/frontend-ci.yml
```yaml
name: Frontend CI

on:
  push:
    branches: [ main, develop ]
    paths: 
      - 'frontend/**'
  pull_request:
    branches: [ main ]
    paths: 
      - 'frontend/**'

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v3

    - name: Setup Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '18'
        cache: 'npm'
        cache-dependency-path: ./frontend/package-lock.json

    - name: Install dependencies
      working-directory: ./frontend
      run: npm ci

    - name: Run ESLint
      working-directory: ./frontend
      run: npm run lint

    - name: Run tests
      working-directory: ./frontend
      run: npm run test -- --coverage --watchAll=false

    - name: Build application
      working-directory: ./frontend
      run: npm run build
      env:
        REACT_APP_API_URL: ${{ secrets.REACT_APP_API_URL }}
        REACT_APP_GOOGLE_MAPS_KEY: ${{ secrets.REACT_APP_GOOGLE_MAPS_KEY }}

    - name: Upload coverage to Codecov
      uses: codecov/codecov-action@v3
      with:
        files: ./frontend/coverage/coverage-final.json
```

### .github/workflows/deploy.yml
```yaml
name: Deploy to Production

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main'

    steps:
    - uses: actions/checkout@v3

    - name: Build and push Docker images
      env:
        DOCKER_REGISTRY: ${{ secrets.DOCKER_REGISTRY }}
        DOCKER_USERNAME: ${{ secrets.DOCKER_USERNAME }}
        DOCKER_PASSWORD: ${{ secrets.DOCKER_PASSWORD }}
      run: |
        echo $DOCKER_PASSWORD | docker login $DOCKER_REGISTRY -u $DOCKER_USERNAME --password-stdin
        
        # Build backend image
        docker build -t $DOCKER_REGISTRY/taxi-backend:latest ./backend
        docker push $DOCKER_REGISTRY/taxi-backend:latest
        
        # Build frontend image
        docker build -t $DOCKER_REGISTRY/taxi-frontend:latest ./frontend
        docker push $DOCKER_REGISTRY/taxi-frontend:latest

    - name: Deploy to server
      uses: appleboy/ssh-action@v0.1.5
      with:
        host: ${{ secrets.SERVER_HOST }}
        username: ${{ secrets.SERVER_USER }}
        key: ${{ secrets.SERVER_SSH_KEY }}
        script: |
          cd /var/www/taxi-app
          git pull origin main
          docker-compose -f docker-compose.prod.yml down
          docker-compose -f docker-compose.prod.yml pull
          docker-compose -f docker-compose.prod.yml up -d
          docker system prune -af
```

---

## üõ†Ô∏è Development Instructions

### 1. Initial Setup
```bash
# Clone the repository
git clone https://github.com/yourusername/taxi-app.git
cd taxi-app

# Copy environment files
cp .env.example .env
cp backend/.env.example backend/.env
cp frontend/.env.example frontend/.env

# Update environment variables
# Edit .env files with your configuration
```

### 2. Environment Variables Setup

#### Backend (.env)
```env
APP_NAME="Taxi Delivery App"
APP_ENV=local
APP_KEY=base64:YOUR_GENERATED_KEY
APP_DEBUG=true
APP_URL=http://localhost:8000

DB_CONNECTION=mysql
DB_HOST=mysql
DB_PORT=3306
DB_DATABASE=taxi_app
DB_USERNAME=taxi_user
DB_PASSWORD=taxi_password

REDIS_HOST=redis
REDIS_PASSWORD=null
REDIS_PORT=6379

GOOGLE_MAPS_API_KEY=your_google_maps_key
PUSHER_APP_ID=your_pusher_app_id
PUSHER_APP_KEY=your_pusher_key
PUSHER_APP_SECRET=your_pusher_secret
```

#### Frontend (.env)
```env
REACT_APP_API_URL=http://localhost:8000/api
REACT_APP_SOCKET_URL=http://localhost:8000
REACT_APP_GOOGLE_MAPS_KEY=your_google_maps_key
```

### 3. Start Development Environment
```bash
# Build and start all services
docker-compose up -d --build

# Check if services are running
docker-compose ps

# View logs
docker-compose logs -f backend
docker-compose logs -f frontend
```

### 4. Backend Setup
```bash
# Access backend container
docker-compose exec backend bash

# Install dependencies
composer install

# Generate application key
php artisan key:generate

# Run migrations and seeders
php artisan migrate:fresh --seed

# Install Laravel Passport
php artisan passport:install

# Start Laravel Echo Server
laravel-echo-server start
```

### 5. Frontend Setup
```bash
# Access frontend container
docker-compose exec frontend sh

# Install dependencies
npm install

# Start development server
npm start
```

---

## üîß API Development

### Key Backend Controllers

#### AuthController.php
```php
<?php

namespace App\Http\Controllers;

use Illuminate\Http\Request;
use App\Models\User;
use Illuminate\Support\Facades\Auth;
use Illuminate\Support\Facades\Hash;
use Illuminate\Validation\Rules\Password;

class AuthController extends Controller
{
    public function register(Request $request)
    {
        $request->validate([
            'name' => 'required|string|max:255',
            'email' => 'required|string|email|max:255|unique:users',
            'phone' => 'required|string|max:20|unique:users',
            'password' => ['required', 'confirmed', Password::defaults()],
            'user_type' => 'required|in:customer,driver',
        ]);

        $user = User::create([
            'name' => $request->name,
            'email' => $request->email,
            'phone' => $request->phone,
            'password' => Hash::make($request->password),
            'user_type' => $request->user_type,
        ]);

        $token = $user->createToken('auth_token')->accessToken;

        return response()->json([
            'user' => $user,
            'token' => $token,
            'token_type' => 'Bearer',
        ]);
    }

    public function login(Request $request)
    {
        $request->validate([
            'email' => 'required|email',
            'password' => 'required',
        ]);

        if (!Auth::attempt($request->only('email', 'password'))) {
            return response()->json([
                'message' => 'Invalid credentials'
            ], 401);
        }

        $user = User::where('email', $request->email)->firstOrFail();
        $token = $user->createToken('auth_token')->accessToken;

        return response()->json([
            'user' => $user,
            'token' => $token,
            'token_type' => 'Bearer',
        ]);
    }
}
```

#### RideController.php
```php
<?php

namespace App\Http\Controllers;

use App\Models\Ride;
use App\Models\Driver;
use App\Services\MapService;
use App\Events\RideCreated;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Auth;

class RideController extends Controller
{
    protected $mapService;

    public function __construct(MapService $mapService)
    {
        $this->mapService = $mapService;
    }

    public function create(Request $request)
    {
        $request->validate([
            'pickup_address' => 'required|string',
            'pickup_latitude' => 'required|numeric',
            'pickup_longitude' => 'required|numeric',
            'destination_address' => 'required|string',
            'destination_latitude' => 'required|numeric',
            'destination_longitude' => 'required|numeric',
        ]);

        // Calculate distance and estimated time
        $routeData = $this->mapService->calculateRoute(
            $request->pickup_latitude,
            $request->pickup_longitude,
            $request->destination_latitude,
            $request->destination_longitude
        );

        $ride = Ride::create([
            'customer_id' => Auth::id(),
            'pickup_address' => $request->pickup_address,
            'pickup_latitude' => $request->pickup_latitude,
            'pickup_longitude' => $request->pickup_longitude,
            'destination_address' => $request->destination_address,
            'destination_latitude' => $request->destination_latitude,
            'destination_longitude' => $request->destination_longitude,
            'distance_km' => $routeData['distance'],
            'estimated_duration_minutes' => $routeData['duration'],
            'fare_amount' => $this->calculateFare($routeData['distance']),
        ]);

        // Notify nearby drivers
        broadcast(new RideCreated($ride));

        return response()->json($ride);
    }

    public function findNearbyDrivers(Request $request)
    {
        $latitude = $request->latitude;
        $longitude = $request->longitude;
        $radius = $request->radius ?? 5; // Default 5km radius

        $drivers = Driver::select('drivers.*', 'users.name', 'users.phone')
            ->join('users', 'drivers.user_id', '=', 'users.id')
            ->where('is_available', true)
            ->whereRaw("
                ST_Distance_Sphere(
                    point(current_longitude, current_latitude),
                    point(?, ?)
                ) <= ? * 1000
            ", [$longitude, $latitude, $radius])
            ->get();

        return response()->json($drivers);
    }

    private function calculateFare($distance)
    {
        $baseFare = 50; // Base fare in BDT
        $perKmRate = 15; // Rate per km in BDT
        
        return $baseFare + ($distance * $perKmRate);
    }
}
```

### Frontend Services

#### api.js
```javascript
import axios from 'axios';

const API_BASE_URL = process.env.REACT_APP_API_URL || 'http://localhost:8000/api';

const api = axios.create({
  baseURL: API_BASE_URL,
  headers: {
    'Content-Type': 'application/json',
  },
});

// Request interceptor to add auth token
api.interceptors.request.use(
  (config) => {
    const token = localStorage.getItem('auth_token');
    if (token) {
      config.headers.Authorization = `Bearer ${token}`;
    }
    return config;
  },
  (error) => {
    return Promise.reject(error);
  }
);

// Response interceptor to handle auth errors
api.interceptors.response.use(
  (response) => response,
  (error) => {
    if (error.response?.status === 401) {
      localStorage.removeItem('auth_token');
      window.location.href = '/login';
    }
    return Promise.reject(error);
  }
);

export const authAPI = {
  login: (credentials) => api.post('/login', credentials),
  register: (userData) => api.post('/register', userData),
  logout: () => api.post('/logout'),
  getProfile: () => api.get('/profile'),
};

export const rideAPI = {
  create: (rideData) => api.post('/rides', rideData),
  getNearbyDrivers: (location) => api.get('/rides/nearby-drivers', { params: location }),
  getUserRides: () => api.get('/rides/user'),
  getRide: (id) => api.get(`/rides/${id}`),
  acceptRide: (id) => api.post(`/rides/${id}/accept`),
  startRide: (id) => api.post(`/rides/${id}/start`),
  completeRide: (id) => api.post(`/rides/${id}/complete`),
};

export const chatAPI = {
  getRideMessages: (rideId) => api.get(`/rides/${rideId}/messages`),
  sendMessage: (rideId, message) => api.post(`/rides/${rideId}/messages`, { message }),
};

export default api;
```

---

## üöÄ Deployment Instructions

### 1. Production Environment Setup
```bash
# Create production environment file
cp docker-compose.yml docker-compose.prod.yml

# Update production configuration
# - Use production database credentials
# - Set proper environment variables
# - Configure SSL certificates
# - Set up domain names
```

### 2. Server Setup (Ubuntu 20.04+)
```bash
# Update system
sudo apt update && sudo apt upgrade -y

# Install Docker
curl -fsSL https://get.docker.com -o get-docker.sh
sh get-docker.sh
sudo usermod -aG docker $USER

# Install Docker Compose
sudo curl -L "https://github.com/docker/compose/releases/download/v2.20.0/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
sudo chmod +x /usr/local/bin/docker-compose

# Clone repository
git clone https://github.com/yourusername/taxi-app.git
cd taxi-app

# Set up environment variables for production
cp .env.example .env
# Edit .env with production values

# Deploy application
docker-compose -f docker-compose.prod.yml up -d --build
```

### 3. GitHub Actions Secrets
Add these secrets to your GitHub repository:
- `SERVER_HOST`: Your server IP address
- `SERVER_USER`: SSH username
- `SERVER_SSH_KEY`: Private SSH key for server access
- `DOCKER_REGISTRY`: Docker registry URL
- `DOCKER_USERNAME`: Docker registry username  
- `DOCKER_PASSWORD`: Docker registry password
- `REACT_APP_API_URL`: Production API URL
- `REACT_APP_GOOGLE_MAPS_KEY`: Google Maps API key

### 4. SSL Certificate Setup (Let's Encrypt)
```bash
# Install Certbot
sudo apt install certbot python3-certbot-nginx

# Get SSL certificate
sudo certbot --nginx -d yourdomain.com -d www.yourdomain.com

# Auto-renewal
sudo crontab -e
# Add: 0 12 * * * /usr/bin/certbot renew --quiet
```

---

## üß™ Testing Strategy

### Backend Testing
```bash
# Run all tests
docker-compose exec backend php artisan test

# Run specific test suite
docker-compose exec backend php artisan test --testsuite=Feature
docker-compose exec backend php artisan test --testsuite=Unit

# Run tests with coverage
docker-compose exec backend php artisan test --coverage
```

### Frontend Testing
```bash
# Run all tests
docker-compose exec frontend npm test

# Run tests in CI mode
docker-compose exec frontend npm test -- --coverage --watchAll=false

# Run specific test file
docker-compose exec frontend npm test -- AuthContext.test.js
```

---

## üì± Key Features Implementation

### Real-time Location Tracking
- Use Redis pub/sub for broadcasting driver locations
- WebSocket connections for live updates
- Google Maps API for accurate positioning

### Chat System
- Laravel Echo for real-time messaging
- Store messages in MySQL for persistence
- Push notifications for offline users

### Payment Integration
- Support for cash, card, and mobile banking
- Integration with local payment gateways (SSLCommerz for Bangladesh)
- Automatic fare calculation based on distance

### Security Features
- JWT token authentication
- API rate limiting
- Input validation and sanitization
- SQL injection protection
- XSS protection

---

This complete guide provides everything needed to build, develop, and deploy a full-featured taxi delivery app with modern DevOps practices. The combination of Docker, Git workflows, and automated CI/CD ensures a professional development and deployment process.
